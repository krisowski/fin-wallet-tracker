<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Portfolio Visualization</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 10px;
        }
        .generated-info {
            text-align: center;
            color: #666;
            font-size: 14px;
            margin-bottom: 30px;
        }
        .filter-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
            gap: 10px;
        }
        .filter-label {
            font-weight: bold;
            color: #333;
        }
        .filter-dropdown {
            padding: 8px 12px;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            background-color: white;
            font-size: 14px;
            cursor: pointer;
            min-width: 150px;
        }
        .filter-dropdown:hover {
            border-color: #007bff;
        }
        .chart-container {
            position: relative;
            height: 400px;
            margin-bottom: 20px;
        }
        .stats-header {
            text-align: center;
            margin-top: 30px;
            margin-bottom: 10px;
        }
        .stats-label {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            padding: 8px 16px;
            background-color: #f8f9fa;
            border-radius: 5px;
            display: inline-block;
        }
        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        .stat-box {
            text-align: center;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
            min-width: 150px;
            margin: 10px;
        }
        .stat-label {
            color: #666;
            font-size: 14px;
            margin-bottom: 5px;
        }
        .stat-value {
            color: #333;
            font-size: 24px;
            font-weight: bold;
        }
        .stat-value.positive {
            color: #28a745;
        }
        .stat-value.negative {
            color: #dc3545;
        }
        .holdings-section {
            margin-top: 40px;
        }
        .holdings-section h2 {
            color: #333;
            border-bottom: 2px solid #dee2e6;
            padding-bottom: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }
        th {
            background-color: #f8f9fa;
            font-weight: bold;
            color: #495057;
        }
        tr:hover {
            background-color: #f8f9fa;
        }
        .ticker {
            font-weight: bold;
            color: #007bff;
        }
        td.positive {
            color: #28a745;
            font-weight: bold;
        }
        td.negative {
            color: #dc3545;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Stock Portfolio Visualization</h1>
        <div class="generated-info">Data generated: 2025-11-21 21:29:53</div>

        <div class="filter-container">
            <label class="filter-label" for="tickerFilter">Select Ticker:</label>
            <select id="tickerFilter" class="filter-dropdown">
                <option value="all">All Tickers</option>
                <option value="total">Total Portfolio Only</option>
                <option value="BRK-B">BRK-B</option>
                <option value="EMIM.AS">EMIM.AS</option>
                <option value="VHVE.L">VHVE.L</option>
            </select>
            <label class="filter-label" for="currencyFilter">Currency:</label>
            <select id="currencyFilter" class="filter-dropdown">
                <option value="PLN">PLN</option>
                <option value="USD">USD</option>
                <option value="EUR">EUR</option>
            </select>
        </div>

        <div class="chart-container">
            <canvas id="portfolioChart"></canvas>
        </div>

        <div class="stats-header">
            <span class="stats-label" id="statsLabel">All Tickers</span>
        </div>

        <div class="stats">
            <div class="stat-box">
                <div class="stat-label">Current Value</div>
                <div class="stat-value" id="statCurrentValue">169,820.65 PLN</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Total Cost</div>
                <div class="stat-value" id="statTotalCost">140,217.29 PLN</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Total Profit/Loss</div>
                <div class="stat-value positive" id="statProfit">+29,603.36 PLN</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Return</div>
                <div class="stat-value positive" id="statReturn">+21.11%</div>
            </div>
        </div>

        <div class="holdings-section">
            <h2>Current Holdings</h2>
            <table>
                <thead>
                    <tr>
                        <th>Ticker</th>
                        <th>Quantity</th>
                        <th>Cost Basis</th>
                        <th>Current Price</th>
                        <th>Current Value</th>
                        <th>Profit/Loss</th>
                        <th>Return %</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="ticker">VHVE.L</td>
                        <td>293.0</td>
                        <td>115,512.32 PLN</td>
                        <td>485.56 PLN</td>
                        <td>142,269.16 PLN</td>
                        <td class="positive">+26,756.84 PLN</td>
                        <td class="positive">+23.16%</td>
                    </tr>
                    <tr>
                        <td class="ticker">EMIM.AS</td>
                        <td>81.0</td>
                        <td>10,397.14 PLN</td>
                        <td>164.45 PLN</td>
                        <td>13,320.15 PLN</td>
                        <td class="positive">+2,923.01 PLN</td>
                        <td class="positive">+28.11%</td>
                    </tr>
                    <tr>
                        <td class="ticker">BRK-B</td>
                        <td>8.0</td>
                        <td>14,307.83 PLN</td>
                        <td>1,778.92 PLN</td>
                        <td>14,231.34 PLN</td>
                        <td class="negative">-76.49 PLN</td>
                        <td class="negative">-0.53%</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="holdings-section">
            <h2>Transactions</h2>
            <table>
                <thead>
                    <tr>
                        <th>Ticker</th>
                        <th>Purchase Date</th>
                        <th>Quantity</th>
                        <th>Currency</th>
                        <th>Purchase Price</th>
                        <th>Transaction Fees</th>
                        <th>Total Cost (Original)</th>
                        <th>Total Cost (PLN)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="ticker">VHVE.L</td>
                        <td>2023-01-03</td>
                        <td>7.0</td>
                        <td><strong>USD</strong></td>
                        <td>76.11 USD</td>
                        <td>4.28 USD</td>
                        <td>537.06 USD</td>
                        <td>2,382.69 PLN</td>
                    </tr>
                    <tr>
                        <td class="ticker">VHVE.L</td>
                        <td>2023-01-03</td>
                        <td>20.0</td>
                        <td><strong>USD</strong></td>
                        <td>76.10 USD</td>
                        <td>1.68 USD</td>
                        <td>1,523.68 USD</td>
                        <td>6,759.85 PLN</td>
                    </tr>
                    <tr>
                        <td class="ticker">VHVE.L</td>
                        <td>2023-01-03</td>
                        <td>24.0</td>
                        <td><strong>USD</strong></td>
                        <td>76.10 USD</td>
                        <td>5.30 USD</td>
                        <td>1,831.70 USD</td>
                        <td>8,126.40 PLN</td>
                    </tr>
                    <tr>
                        <td class="ticker">EMIM.AS</td>
                        <td>2023-01-04</td>
                        <td>56.0</td>
                        <td><strong>EUR</strong></td>
                        <td>27.31 EUR</td>
                        <td>4.44 EUR</td>
                        <td>1,533.57 EUR</td>
                        <td>7,188.15 PLN</td>
                    </tr>
                    <tr>
                        <td class="ticker">EMIM.AS</td>
                        <td>2023-01-05</td>
                        <td>25.0</td>
                        <td><strong>EUR</strong></td>
                        <td>27.48 EUR</td>
                        <td>1.99 EUR</td>
                        <td>689.04 EUR</td>
                        <td>3,208.99 PLN</td>
                    </tr>
                    <tr>
                        <td class="ticker">VHVE.L</td>
                        <td>2023-01-09</td>
                        <td>36.0</td>
                        <td><strong>USD</strong></td>
                        <td>77.50 USD</td>
                        <td>8.09 USD</td>
                        <td>2,798.09 USD</td>
                        <td>12,262.68 PLN</td>
                    </tr>
                    <tr>
                        <td class="ticker">VHVE.L</td>
                        <td>2023-02-24</td>
                        <td>59.0</td>
                        <td><strong>USD</strong></td>
                        <td>78.88 USD</td>
                        <td>13.50 USD</td>
                        <td>4,667.42 USD</td>
                        <td>20,859.01 PLN</td>
                    </tr>
                    <tr>
                        <td class="ticker">VHVE.L</td>
                        <td>2024-10-21</td>
                        <td>32.0</td>
                        <td><strong>USD</strong></td>
                        <td>110.96 USD</td>
                        <td>10.30 USD</td>
                        <td>3,561.02 USD</td>
                        <td>14,193.56 PLN</td>
                    </tr>
                    <tr>
                        <td class="ticker">VHVE.L</td>
                        <td>2024-11-19</td>
                        <td>13.0</td>
                        <td><strong>USD</strong></td>
                        <td>109.90 USD</td>
                        <td>14.69 USD</td>
                        <td>1,443.39 USD</td>
                        <td>5,926.77 PLN</td>
                    </tr>
                    <tr>
                        <td class="ticker">VHVE.L</td>
                        <td>2024-11-26</td>
                        <td>22.0</td>
                        <td><strong>USD</strong></td>
                        <td>112.00 USD</td>
                        <td>7.14 USD</td>
                        <td>2,471.14 USD</td>
                        <td>10,106.06 PLN</td>
                    </tr>
                    <tr>
                        <td class="ticker">VHVE.L</td>
                        <td>2024-12-12</td>
                        <td>16.0</td>
                        <td><strong>USD</strong></td>
                        <td>113.52 USD</td>
                        <td>5.27 USD</td>
                        <td>1,821.59 USD</td>
                        <td>7,412.93 PLN</td>
                    </tr>
                    <tr>
                        <td class="ticker">VHVE.L</td>
                        <td>2025-04-15</td>
                        <td>37.0</td>
                        <td><strong>USD</strong></td>
                        <td>105.58 USD</td>
                        <td>11.33 USD</td>
                        <td>3,917.82 USD</td>
                        <td>14,812.76 PLN</td>
                    </tr>
                    <tr>
                        <td class="ticker">VHVE.L</td>
                        <td>2025-09-22</td>
                        <td>24.0</td>
                        <td><strong>USD</strong></td>
                        <td>129.92 USD</td>
                        <td>0.00 USD</td>
                        <td>3,118.08 USD</td>
                        <td>11,261.88 PLN</td>
                    </tr>
                    <tr>
                        <td class="ticker">BRK-B</td>
                        <td>2025-09-23</td>
                        <td>8.0</td>
                        <td><strong>USD</strong></td>
                        <td>493.00 USD</td>
                        <td>11.44 USD</td>
                        <td>3,955.44 USD</td>
                        <td>14,307.83 PLN</td>
                    </tr>
                    <tr>
                        <td class="ticker">VHVE.L</td>
                        <td>2025-09-23</td>
                        <td>3.0</td>
                        <td><strong>USD</strong></td>
                        <td>129.92 USD</td>
                        <td>0.00 USD</td>
                        <td>389.76 USD</td>
                        <td>1,407.73 PLN</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        const ctx = document.getElementById('portfolioChart').getContext('2d');

        // Currency settings (must be declared before chart creation)
        let currentCurrency = 'PLN';

        // Ticker value datasets
        const tickerValueDatasets = [{"label": "BRK-B", "data": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 14480.08, 14231.34], "dataUSD": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3985.6, 3904.56], "dataEUR": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3396.13, 3356.75], "dataPLN": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 14480.08, 14231.34], "borderColor": "rgb(255, 99, 132)", "backgroundColor": "rgba(255, 99, 132, 0.2)", "tension": 0.1, "fill": true, "tickerName": "BRK-B", "quantities": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 8.0, 8.0], "profits": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 172.2523199999996, -76.48768000000018], "profitsUSD": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -10322.22768, -10403.26768], "profitsEUR": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -10911.697680000001, -10951.07768], "profitsPLN": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 172.2523199999996, -76.48768000000018]}, {"label": "EMIM.AS", "data": [10882.52, 10509.98, 10185.04, 9809.19, 9992.8, 9914.18, 10340.1, 10244.56, 10328.59, 9726.36, 9933.66, 9962.41, 9930.28, 10355.54, 10427.46, 10711.79, 10869.78, 11159.5, 11007.59, 10855.57, 11513.75, 11584.67, 11486.28, 11376.67, 11000.98, 11419.65, 11036.7, 10608.58, 11236.55, 11523.05, 11788.46, 12023.02, 12829.81, 13320.15], "dataUSD": [2510.78, 2362.88, 2344.05, 2353.7, 2361.52, 2436.6, 2584.32, 2484.89, 2374.81, 2311.06, 2487.07, 2537.95, 2480.1, 2594.11, 2618.33, 2638.74, 2772.26, 2778.16, 2778.4, 2831.57, 2996.77, 2898.36, 2784.07, 2781.85, 2735.35, 2876.33, 2855.99, 2813.44, 3019.11, 3202.22, 3150.8, 3299.53, 3531.54, 3654.76], "dataEUR": [2311.74, 2233.98, 2174.85, 2137.59, 2208.06, 2233.98, 2349.81, 2291.49, 2242.08, 2184.57, 2283.39, 2295.54, 2295.54, 2400.84, 2425.95, 2473.74, 2555.55, 2587.95, 2566.89, 2536.11, 2690.82, 2662.47, 2665.71, 2668.95, 2613.06, 2745.9, 2639.79, 2484.27, 2651.13, 2716.74, 2758.05, 2822.04, 3009.15, 3141.99], "dataPLN": [10882.52, 10509.98, 10185.04, 9809.19, 9992.8, 9914.18, 10340.1, 10244.56, 10328.59, 9726.36, 9933.66, 9962.41, 9930.28, 10355.54, 10427.46, 10711.79, 10869.78, 11159.5, 11007.59, 10855.57, 11513.75, 11584.67, 11486.28, 11376.67, 11000.98, 11419.65, 11036.7, 10608.58, 11236.55, 11523.05, 11788.46, 12023.02, 12829.81, 13320.15], "borderColor": "rgb(54, 162, 235)", "backgroundColor": "rgba(54, 162, 235, 0.2)", "tension": 0.1, "fill": true, "tickerName": "EMIM.AS", "quantities": [81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0], "profits": [485.380970000002, 112.84097000000111, -212.09902999999758, -587.949029999998, -404.3390299999992, -482.95902999999817, -57.03902999999809, -152.57902999999897, -68.54902999999831, -670.7790299999979, -463.4790299999986, -434.7290299999986, -466.8590299999978, -41.59902999999758, 30.32097000000067, 314.6509700000024, 472.6409700000022, 762.3609700000015, 610.4509700000017, 458.43097000000125, 1116.6109700000015, 1187.5309700000016, 1089.1409700000022, 979.5309700000016, 603.8409700000011, 1022.5109700000012, 639.5609700000023, 211.44097000000147, 839.4109700000008, 1125.9109700000008, 1391.3209700000007, 1625.880970000002, 2432.670970000001, 2923.010970000001], "profitsUSD": [-7886.359029999998, -8034.259029999998, -8053.089029999998, -8043.439029999999, -8035.619029999998, -7960.539029999998, -7812.819029999999, -7912.249029999999, -8022.329029999999, -8086.079029999999, -7910.069029999999, -7859.189029999999, -7917.039029999998, -7803.029029999998, -7778.8090299999985, -7758.399029999999, -7624.879029999998, -7618.979029999999, -7618.739029999999, -7565.569029999999, -7400.369029999998, -7498.779029999998, -7613.069029999999, -7615.289029999998, -7661.789029999998, -7520.8090299999985, -7541.149029999999, -7583.699029999998, -7378.029029999998, -7194.919029999999, -7246.339029999998, -7097.609029999998, -6865.5990299999985, -6742.379029999998], "profitsEUR": [-8085.399029999999, -8163.159029999999, -8222.289029999998, -8259.549029999998, -8189.079029999999, -8163.159029999999, -8047.329029999999, -8105.649029999999, -8155.0590299999985, -8212.569029999999, -8113.749029999999, -8101.5990299999985, -8101.5990299999985, -7996.299029999998, -7971.189029999999, -7923.399029999999, -7841.589029999998, -7809.189029999999, -7830.249029999999, -7861.029029999998, -7706.319029999999, -7734.669029999999, -7731.429029999998, -7728.189029999999, -7784.079029999999, -7651.239029999999, -7757.3490299999985, -7912.869029999998, -7746.009029999998, -7680.399029999999, -7639.089029999998, -7575.0990299999985, -7387.989029999999, -7255.149029999999], "profitsPLN": [485.380970000002, 112.84097000000111, -212.09902999999758, -587.949029999998, -404.3390299999992, -482.95902999999817, -57.03902999999809, -152.57902999999897, -68.54902999999831, -670.7790299999979, -463.4790299999986, -434.7290299999986, -466.8590299999978, -41.59902999999758, 30.32097000000067, 314.6509700000024, 472.6409700000022, 762.3609700000015, 610.4509700000017, 458.43097000000125, 1116.6109700000015, 1187.5309700000016, 1089.1409700000022, 979.5309700000016, 603.8409700000011, 1022.5109700000012, 639.5609700000023, 211.44097000000147, 839.4109700000008, 1125.9109700000008, 1391.3209700000007, 1625.880970000002, 2432.670970000001, 2923.010970000001]}, {"label": "VHVE.L", "data": [30352.2, 50848.65, 49766.76, 49444.09, 50952.13, 50396.54, 51858.53, 52596.54, 52973.95, 50186.35, 51964.78, 53439.35, 55007.63, 57409.25, 58622.76, 57515.76, 58576.21, 61165.5, 60407.43, 60352.18, 61220.05, 77510.33, 98348.51, 103981.76, 103748.3, 103672.06, 96216.48, 110677.57, 114622.06, 115476.73, 120032.24, 121945.48, 138342.2, 142269.16], "dataUSD": [7002.63, 11431.8, 11449.32, 11862.5, 12039.16, 12385.18, 12960.42, 12757.48, 12179.32, 11925.28, 13010.06, 13613.04, 13737.14, 14386.84, 14719.72, 14167.84, 14938.72, 15227.8, 15248.24, 15741.72, 15931.52, 19387.76, 23843.22, 25432.74, 25794.56, 26110.58, 24896.88, 29350.44, 30797.48, 32090.24, 32079.6, 33460.14, 38078.28, 39033.46], "dataEUR": [6447.32, 10807.62, 10622.68, 10773.52, 11256.61, 11355.97, 11784.91, 11764.95, 11498.5, 11272.97, 11944.54, 12312.99, 12715.1, 13315.02, 13637.82, 13282.35, 13772.01, 14184.7, 14087.85, 14099.86, 14304.91, 17809.6, 22829.88, 24400.17, 24641.54, 24927.77, 23012.19, 25916.44, 27043.27, 27225.36, 28082.48, 28618.46, 32446.5, 33557.07], "dataPLN": [30352.2, 50848.65, 49766.76, 49444.09, 50952.13, 50396.54, 51858.53, 52596.54, 52973.95, 50186.35, 51964.78, 53439.35, 55007.63, 57409.25, 58622.76, 57515.76, 58576.21, 61165.5, 60407.43, 60352.18, 61220.05, 77510.33, 98348.51, 103981.76, 103748.3, 103672.06, 96216.48, 110677.57, 114622.06, 115476.73, 120032.24, 121945.48, 138342.2, 142269.16], "borderColor": "rgb(255, 206, 86)", "backgroundColor": "rgba(255, 206, 86, 0.2)", "tension": 0.1, "fill": true, "tickerName": "VHVE.L", "quantities": [87.0, 146.0, 146.0, 146.0, 146.0, 146.0, 146.0, 146.0, 146.0, 146.0, 146.0, 146.0, 146.0, 146.0, 146.0, 146.0, 146.0, 146.0, 146.0, 146.0, 146.0, 178.0, 213.0, 229.0, 229.0, 229.0, 229.0, 266.0, 266.0, 266.0, 266.0, 266.0, 293.0, 293.0], "profits": [820.5800000000017, 458.0205600000045, -623.8694399999949, -946.5394400000005, 561.5005600000004, 5.910560000003898, 1467.9005600000019, 2205.910560000004, 2583.32056, -204.27943999999843, 1574.1505600000019, 3048.7205600000016, 4617.00056, 7018.620560000003, 8232.130560000005, 7125.130560000005, 8185.580560000002, 10774.870560000003, 10016.800560000003, 9961.550560000003, 10829.420560000006, 12926.144080000005, 17731.49338, 15951.812820000006, 15718.352820000015, 15642.11282000001, 8186.532820000008, 7834.858280000015, 11779.348280000006, 12634.018280000004, 17189.528280000013, 19102.768280000004, 22829.878680000023, 26756.838680000015], "profitsUSD": [-22528.989999999998, -38958.82944, -38941.30944, -38528.12944, -38351.46944, -38005.44944, -37430.20944, -37633.149439999994, -38211.30944, -38465.34944, -37380.56944, -36777.589439999996, -36653.48944, -36003.78943999999, -35670.909439999996, -36222.78943999999, -35451.909439999996, -35162.82944, -35142.38944, -34648.909439999996, -34459.10944, -45196.425919999994, -56773.796619999994, -62597.20717999998, -62235.38717999999, -61919.36717999999, -63133.06717999998, -73492.27171999999, -72045.23172, -70752.47171999999, -70763.11171999999, -69382.57171999999, -77434.04131999999, -76478.86132], "profitsEUR": [-23084.3, -39583.009439999994, -39767.94944, -39617.10944, -39134.01944, -39034.659439999996, -38605.71944, -38625.67943999999, -38892.12944, -39117.659439999996, -38446.089439999996, -38077.63944, -37675.52944, -37075.60944, -36752.80944, -37108.27944, -36618.619439999995, -36205.92943999999, -36302.77944, -36290.76944, -36085.71944, -46774.58592, -57787.13661999999, -63629.77717999999, -63388.40717999999, -63102.177179999984, -65017.757179999986, -76926.27171999999, -75799.44171999999, -75617.35171999999, -74760.23172, -74224.25172, -83065.82131999999, -81955.25131999998], "profitsPLN": [820.5800000000017, 458.0205600000045, -623.8694399999949, -946.5394400000005, 561.5005600000004, 5.910560000003898, 1467.9005600000019, 2205.910560000004, 2583.32056, -204.27943999999843, 1574.1505600000019, 3048.7205600000016, 4617.00056, 7018.620560000003, 8232.130560000005, 7125.130560000005, 8185.580560000002, 10774.870560000003, 10016.800560000003, 9961.550560000003, 10829.420560000006, 12926.144080000005, 17731.49338, 15951.812820000006, 15718.352820000015, 15642.11282000001, 8186.532820000008, 7834.858280000015, 11779.348280000006, 12634.018280000004, 17189.528280000013, 19102.768280000004, 22829.878680000023, 26756.838680000015]}];

        // Ticker profit datasets
        const tickerProfitDatasets = [{"label": "BRK-B Profit", "data": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 172.2523199999996, -76.48768000000018], "dataUSD": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -10322.22768, -10403.26768], "dataEUR": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -10911.697680000001, -10951.07768], "dataPLN": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 172.2523199999996, -76.48768000000018], "borderColor": "rgba(255, 99, 132, 0.8)", "backgroundColor": "transparent", "tension": 0.1, "fill": false, "borderDash": [5, 5], "borderWidth": 2, "tickerName": "BRK-B", "isProfit": true, "hidden": false, "order": 2, "quantities": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 8.0, 8.0]}, {"label": "EMIM.AS Profit", "data": [485.380970000002, 112.84097000000111, -212.09902999999758, -587.949029999998, -404.3390299999992, -482.95902999999817, -57.03902999999809, -152.57902999999897, -68.54902999999831, -670.7790299999979, -463.4790299999986, -434.7290299999986, -466.8590299999978, -41.59902999999758, 30.32097000000067, 314.6509700000024, 472.6409700000022, 762.3609700000015, 610.4509700000017, 458.43097000000125, 1116.6109700000015, 1187.5309700000016, 1089.1409700000022, 979.5309700000016, 603.8409700000011, 1022.5109700000012, 639.5609700000023, 211.44097000000147, 839.4109700000008, 1125.9109700000008, 1391.3209700000007, 1625.880970000002, 2432.670970000001, 2923.010970000001], "dataUSD": [-7886.359029999998, -8034.259029999998, -8053.089029999998, -8043.439029999999, -8035.619029999998, -7960.539029999998, -7812.819029999999, -7912.249029999999, -8022.329029999999, -8086.079029999999, -7910.069029999999, -7859.189029999999, -7917.039029999998, -7803.029029999998, -7778.8090299999985, -7758.399029999999, -7624.879029999998, -7618.979029999999, -7618.739029999999, -7565.569029999999, -7400.369029999998, -7498.779029999998, -7613.069029999999, -7615.289029999998, -7661.789029999998, -7520.8090299999985, -7541.149029999999, -7583.699029999998, -7378.029029999998, -7194.919029999999, -7246.339029999998, -7097.609029999998, -6865.5990299999985, -6742.379029999998], "dataEUR": [-8085.399029999999, -8163.159029999999, -8222.289029999998, -8259.549029999998, -8189.079029999999, -8163.159029999999, -8047.329029999999, -8105.649029999999, -8155.0590299999985, -8212.569029999999, -8113.749029999999, -8101.5990299999985, -8101.5990299999985, -7996.299029999998, -7971.189029999999, -7923.399029999999, -7841.589029999998, -7809.189029999999, -7830.249029999999, -7861.029029999998, -7706.319029999999, -7734.669029999999, -7731.429029999998, -7728.189029999999, -7784.079029999999, -7651.239029999999, -7757.3490299999985, -7912.869029999998, -7746.009029999998, -7680.399029999999, -7639.089029999998, -7575.0990299999985, -7387.989029999999, -7255.149029999999], "dataPLN": [485.380970000002, 112.84097000000111, -212.09902999999758, -587.949029999998, -404.3390299999992, -482.95902999999817, -57.03902999999809, -152.57902999999897, -68.54902999999831, -670.7790299999979, -463.4790299999986, -434.7290299999986, -466.8590299999978, -41.59902999999758, 30.32097000000067, 314.6509700000024, 472.6409700000022, 762.3609700000015, 610.4509700000017, 458.43097000000125, 1116.6109700000015, 1187.5309700000016, 1089.1409700000022, 979.5309700000016, 603.8409700000011, 1022.5109700000012, 639.5609700000023, 211.44097000000147, 839.4109700000008, 1125.9109700000008, 1391.3209700000007, 1625.880970000002, 2432.670970000001, 2923.010970000001], "borderColor": "rgba(54, 162, 235, 0.8)", "backgroundColor": "transparent", "tension": 0.1, "fill": false, "borderDash": [5, 5], "borderWidth": 2, "tickerName": "EMIM.AS", "isProfit": true, "hidden": false, "order": 2, "quantities": [81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0, 81.0]}, {"label": "VHVE.L Profit", "data": [820.5800000000017, 458.0205600000045, -623.8694399999949, -946.5394400000005, 561.5005600000004, 5.910560000003898, 1467.9005600000019, 2205.910560000004, 2583.32056, -204.27943999999843, 1574.1505600000019, 3048.7205600000016, 4617.00056, 7018.620560000003, 8232.130560000005, 7125.130560000005, 8185.580560000002, 10774.870560000003, 10016.800560000003, 9961.550560000003, 10829.420560000006, 12926.144080000005, 17731.49338, 15951.812820000006, 15718.352820000015, 15642.11282000001, 8186.532820000008, 7834.858280000015, 11779.348280000006, 12634.018280000004, 17189.528280000013, 19102.768280000004, 22829.878680000023, 26756.838680000015], "dataUSD": [-22528.989999999998, -38958.82944, -38941.30944, -38528.12944, -38351.46944, -38005.44944, -37430.20944, -37633.149439999994, -38211.30944, -38465.34944, -37380.56944, -36777.589439999996, -36653.48944, -36003.78943999999, -35670.909439999996, -36222.78943999999, -35451.909439999996, -35162.82944, -35142.38944, -34648.909439999996, -34459.10944, -45196.425919999994, -56773.796619999994, -62597.20717999998, -62235.38717999999, -61919.36717999999, -63133.06717999998, -73492.27171999999, -72045.23172, -70752.47171999999, -70763.11171999999, -69382.57171999999, -77434.04131999999, -76478.86132], "dataEUR": [-23084.3, -39583.009439999994, -39767.94944, -39617.10944, -39134.01944, -39034.659439999996, -38605.71944, -38625.67943999999, -38892.12944, -39117.659439999996, -38446.089439999996, -38077.63944, -37675.52944, -37075.60944, -36752.80944, -37108.27944, -36618.619439999995, -36205.92943999999, -36302.77944, -36290.76944, -36085.71944, -46774.58592, -57787.13661999999, -63629.77717999999, -63388.40717999999, -63102.177179999984, -65017.757179999986, -76926.27171999999, -75799.44171999999, -75617.35171999999, -74760.23172, -74224.25172, -83065.82131999999, -81955.25131999998], "dataPLN": [820.5800000000017, 458.0205600000045, -623.8694399999949, -946.5394400000005, 561.5005600000004, 5.910560000003898, 1467.9005600000019, 2205.910560000004, 2583.32056, -204.27943999999843, 1574.1505600000019, 3048.7205600000016, 4617.00056, 7018.620560000003, 8232.130560000005, 7125.130560000005, 8185.580560000002, 10774.870560000003, 10016.800560000003, 9961.550560000003, 10829.420560000006, 12926.144080000005, 17731.49338, 15951.812820000006, 15718.352820000015, 15642.11282000001, 8186.532820000008, 7834.858280000015, 11779.348280000006, 12634.018280000004, 17189.528280000013, 19102.768280000004, 22829.878680000023, 26756.838680000015], "borderColor": "rgba(255, 206, 86, 0.8)", "backgroundColor": "transparent", "tension": 0.1, "fill": false, "borderDash": [5, 5], "borderWidth": 2, "tickerName": "VHVE.L", "isProfit": true, "hidden": false, "order": 2, "quantities": [87.0, 146.0, 146.0, 146.0, 146.0, 146.0, 146.0, 146.0, 146.0, 146.0, 146.0, 146.0, 146.0, 146.0, 146.0, 146.0, 146.0, 146.0, 146.0, 146.0, 146.0, 178.0, 213.0, 229.0, 229.0, 229.0, 229.0, 266.0, 266.0, 266.0, 266.0, 266.0, 293.0, 293.0]}];

        // Total portfolio value dataset
        const totalValueDataset = {
            label: 'Total Portfolio',
            data: [41234.72, 61358.63, 59951.8, 59253.27, 60944.93, 60310.72, 62198.63, 62841.1, 63302.54, 59912.71, 61898.44, 63401.76, 64937.91, 67764.79, 69050.22, 68227.55, 69445.99, 72325.0, 71415.02, 71207.75, 72733.8, 89095.0, 109834.79, 115358.42, 114749.28, 115091.71, 107253.18, 121286.15, 125858.61, 126999.78, 131820.7, 133968.5, 165652.09, 169820.65],
            dataUSD: [9513.41, 13794.68, 13793.37, 14216.2, 14400.68, 14821.78, 15544.74, 15242.37, 14554.13, 14236.34, 15497.13, 16150.99, 16217.24, 16980.95, 17338.05, 16806.58, 17710.98, 18005.96, 18026.64, 18573.29, 18928.29, 22286.12, 26627.29, 28214.59, 28529.91, 28986.91, 27752.87, 32163.88, 33816.59, 35292.46, 35230.4, 36759.67, 45595.42, 46592.78],
            dataEUR: [8759.06, 13041.6, 12797.53, 12911.11, 13464.67, 13589.95, 14134.72, 14056.44, 13740.58, 13457.54, 14227.93, 14608.53, 15010.64, 15715.86, 16063.77, 15756.09, 16327.56, 16772.65, 16654.74, 16635.97, 16995.73, 20472.07, 25495.59, 27069.12, 27254.6, 27673.67, 25651.98, 28400.71, 29694.4, 29942.1, 30840.53, 31440.5, 38851.78, 40055.81],
            dataPLN: [41234.72, 61358.63, 59951.8, 59253.27, 60944.93, 60310.72, 62198.63, 62841.1, 63302.54, 59912.71, 61898.44, 63401.76, 64937.91, 67764.79, 69050.22, 68227.55, 69445.99, 72325.0, 71415.02, 71207.75, 72733.8, 89095.0, 109834.79, 115358.42, 114749.28, 115091.71, 107253.18, 121286.15, 125858.61, 126999.78, 131820.7, 133968.5, 165652.09, 169820.65],
            borderColor: 'rgb(0, 0, 0)',
            backgroundColor: 'rgba(0, 0, 0, 0.1)',
            tension: 0.1,
            fill: true,
            borderWidth: 3,
            tickerName: 'total',
            quantities: [168.0, 227.0, 227.0, 227.0, 227.0, 227.0, 227.0, 227.0, 227.0, 227.0, 227.0, 227.0, 227.0, 227.0, 227.0, 227.0, 227.0, 227.0, 227.0, 227.0, 227.0, 259.0, 294.0, 310.0, 310.0, 310.0, 310.0, 347.0, 347.0, 347.0, 347.0, 347.0, 382.0, 382.0],
            profits: [1305.96097, 570.861530000002, -835.9684699999925, -1534.4984699999986, 157.16153000000486, -477.04846999999427, 1410.861530000002, 2053.331530000003, 2514.7715300000054, -875.0584699999963, 1110.671530000007, 2613.9915300000066, 4150.141530000008, 6977.021529999998, 8262.451530000006, 7439.7815300000075, 8658.22153000001, 11537.231530000005, 10627.251530000009, 10419.981530000005, 11946.031530000007, 14113.675050000005, 18820.634349999993, 16931.33379000002, 16322.19379000002, 16664.623790000027, 8826.093790000014, 8046.299250000011, 12618.759250000017, 13759.929250000016, 18580.84925000003, 20728.649250000017, 25434.80197, 29603.361969999998],
            profitsUSD: [-30415.34903, -46993.088469999995, -46994.39846999999, -46571.56847, -46387.088469999995, -45965.98847, -45243.02847, -45545.39846999999, -46233.63847, -46551.42847, -45290.63847, -44636.77847, -44570.52847, -43806.81847, -43449.71846999999, -43981.188469999994, -43076.78847, -42781.808469999996, -42761.128469999996, -42214.478469999995, -41859.478469999995, -52695.20495, -64386.86565, -70212.49620999998, -69897.17620999998, -69440.17620999998, -70674.21620999998, -81075.97074999998, -79423.26074999999, -77947.39074999999, -78009.45074999999, -76480.18074999998, -94621.86803, -93624.50803],
            profitsEUR: [-31169.699030000003, -47746.16847, -47990.23847, -47876.658469999995, -47323.09847, -47197.81847, -46653.048469999994, -46731.32846999999, -47047.188469999994, -47330.228469999995, -46559.838469999995, -46179.23847, -45777.128469999996, -45071.908469999995, -44723.99846999999, -45031.67847, -44460.20847, -44015.118469999994, -44133.02846999999, -44151.798469999994, -43792.03847, -54509.254949999995, -65518.565650000004, -71357.96620999998, -71172.48620999997, -70753.41620999998, -72775.10620999998, -84839.14074999999, -83545.45074999999, -83297.75074999998, -82399.32074999998, -81799.35074999998, -101365.50803, -100161.47803],
            profitsPLN: [1305.96097, 570.861530000002, -835.9684699999925, -1534.4984699999986, 157.16153000000486, -477.04846999999427, 1410.861530000002, 2053.331530000003, 2514.7715300000054, -875.0584699999963, 1110.671530000007, 2613.9915300000066, 4150.141530000008, 6977.021529999998, 8262.451530000006, 7439.7815300000075, 8658.22153000001, 11537.231530000005, 10627.251530000009, 10419.981530000005, 11946.031530000007, 14113.675050000005, 18820.634349999993, 16931.33379000002, 16322.19379000002, 16664.623790000027, 8826.093790000014, 8046.299250000011, 12618.759250000017, 13759.929250000016, 18580.84925000003, 20728.649250000017, 25434.80197, 29603.361969999998]
        };

        // Total portfolio profit dataset
        const totalProfitDataset = {
            label: 'Total Portfolio Profit',
            data: [1305.96097, 570.861530000002, -835.9684699999925, -1534.4984699999986, 157.16153000000486, -477.04846999999427, 1410.861530000002, 2053.331530000003, 2514.7715300000054, -875.0584699999963, 1110.671530000007, 2613.9915300000066, 4150.141530000008, 6977.021529999998, 8262.451530000006, 7439.7815300000075, 8658.22153000001, 11537.231530000005, 10627.251530000009, 10419.981530000005, 11946.031530000007, 14113.675050000005, 18820.634349999993, 16931.33379000002, 16322.19379000002, 16664.623790000027, 8826.093790000014, 8046.299250000011, 12618.759250000017, 13759.929250000016, 18580.84925000003, 20728.649250000017, 25434.80197, 29603.361969999998],
            dataUSD: [-30415.34903, -46993.088469999995, -46994.39846999999, -46571.56847, -46387.088469999995, -45965.98847, -45243.02847, -45545.39846999999, -46233.63847, -46551.42847, -45290.63847, -44636.77847, -44570.52847, -43806.81847, -43449.71846999999, -43981.188469999994, -43076.78847, -42781.808469999996, -42761.128469999996, -42214.478469999995, -41859.478469999995, -52695.20495, -64386.86565, -70212.49620999998, -69897.17620999998, -69440.17620999998, -70674.21620999998, -81075.97074999998, -79423.26074999999, -77947.39074999999, -78009.45074999999, -76480.18074999998, -94621.86803, -93624.50803],
            dataEUR: [-31169.699030000003, -47746.16847, -47990.23847, -47876.658469999995, -47323.09847, -47197.81847, -46653.048469999994, -46731.32846999999, -47047.188469999994, -47330.228469999995, -46559.838469999995, -46179.23847, -45777.128469999996, -45071.908469999995, -44723.99846999999, -45031.67847, -44460.20847, -44015.118469999994, -44133.02846999999, -44151.798469999994, -43792.03847, -54509.254949999995, -65518.565650000004, -71357.96620999998, -71172.48620999997, -70753.41620999998, -72775.10620999998, -84839.14074999999, -83545.45074999999, -83297.75074999998, -82399.32074999998, -81799.35074999998, -101365.50803, -100161.47803],
            dataPLN: [1305.96097, 570.861530000002, -835.9684699999925, -1534.4984699999986, 157.16153000000486, -477.04846999999427, 1410.861530000002, 2053.331530000003, 2514.7715300000054, -875.0584699999963, 1110.671530000007, 2613.9915300000066, 4150.141530000008, 6977.021529999998, 8262.451530000006, 7439.7815300000075, 8658.22153000001, 11537.231530000005, 10627.251530000009, 10419.981530000005, 11946.031530000007, 14113.675050000005, 18820.634349999993, 16931.33379000002, 16322.19379000002, 16664.623790000027, 8826.093790000014, 8046.299250000011, 12618.759250000017, 13759.929250000016, 18580.84925000003, 20728.649250000017, 25434.80197, 29603.361969999998],
            borderColor: 'rgba(0, 0, 0, 0.8)',
            backgroundColor: 'transparent',
            tension: 0.1,
            fill: false,
            borderDash: [5, 5],
            borderWidth: 3,
            tickerName: 'total',
            isProfit: true,
            hidden: false,
            order: 2,
            quantities: [168.0, 227.0, 227.0, 227.0, 227.0, 227.0, 227.0, 227.0, 227.0, 227.0, 227.0, 227.0, 227.0, 227.0, 227.0, 227.0, 227.0, 227.0, 227.0, 227.0, 227.0, 259.0, 294.0, 310.0, 310.0, 310.0, 310.0, 347.0, 347.0, 347.0, 347.0, 347.0, 382.0, 382.0]
        };

        const chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ["2023-02-01", "2023-03-01", "2023-04-01", "2023-05-01", "2023-06-01", "2023-07-01", "2023-08-01", "2023-09-01", "2023-10-01", "2023-11-01", "2023-12-01", "2024-01-01", "2024-02-01", "2024-03-01", "2024-04-01", "2024-05-01", "2024-06-01", "2024-07-01", "2024-08-01", "2024-09-01", "2024-10-01", "2024-11-01", "2024-12-01", "2025-01-01", "2025-02-01", "2025-03-01", "2025-04-01", "2025-05-01", "2025-06-01", "2025-07-01", "2025-08-01", "2025-09-01", "2025-10-01", "2025-11-01"],
                datasets: [...tickerValueDatasets, ...tickerProfitDatasets, totalValueDataset, totalProfitDataset]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'top',
                        labels: {
                            filter: function(item) {
                                // Only show value datasets in legend, not profit datasets
                                return !item.text.includes('Profit');
                            }
                        },
                        onClick: function(e, legendItem, legend) {
                            const index = legendItem.datasetIndex;
                            const ci = legend.chart;
                            const dataset = ci.data.datasets[index];

                            // Skip if this is a profit dataset (shouldn't happen but safety check)
                            if (dataset.isProfit) return;

                            const tickerName = dataset.tickerName;

                            // Find both value and profit datasets for this ticker
                            ci.data.datasets.forEach((ds, i) => {
                                if (ds.tickerName === tickerName) {
                                    const meta = ci.getDatasetMeta(i);
                                    meta.hidden = meta.hidden === null ? !ci.data.datasets[i].hidden : null;
                                }
                            });

                            ci.update();
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const dataset = context.dataset;
                                const dataIndex = context.dataIndex;
                                const value = context.parsed.y;
                                const currency = currentCurrency;
                                const formattedValue = value.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',') + ' ' + currency;

                                let lines = [];

                                if (dataset.isProfit) {
                                    // Profit dataset - show profit and quantity
                                    lines.push(dataset.label + ': ' + formattedValue);
                                    if (dataset.quantities && dataset.quantities[dataIndex]) {
                                        lines.push('  Shares: ' + dataset.quantities[dataIndex].toFixed(1));
                                    }
                                } else {
                                    // Value dataset - show value, quantity, and profit
                                    lines.push(dataset.label + ': ' + formattedValue);
                                    if (dataset.quantities && dataset.quantities[dataIndex]) {
                                        lines.push('  Shares: ' + dataset.quantities[dataIndex].toFixed(1));
                                    }
                                    if (dataset.profits && dataset.profits[dataIndex] !== undefined) {
                                        const profit = dataset.profits[dataIndex];
                                        const profitSign = profit >= 0 ? '+' : '';
                                        const formattedProfit = profitSign + profit.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',') + ' ' + currency;
                                        lines.push('  Profit: ' + formattedProfit);
                                    }
                                }

                                return lines;
                            }
                        }
                    },
                    annotation: {
                        annotations: [{"type": "line", "xMin": "2023-02-01", "xMax": "2023-02-01", "borderColor": "rgba(255, 99, 71, 0.5)", "borderWidth": 2, "borderDash": [5, 5], "ticker": "VHVE.L", "label": {"display": true, "content": "VHVE.L: +7", "position": "start", "backgroundColor": "rgba(255, 99, 71, 0.8)", "color": "white", "font": {"size": 10, "weight": "bold"}, "padding": 4, "rotation": 0}}, {"type": "line", "xMin": "2023-02-01", "xMax": "2023-02-01", "borderColor": "rgba(255, 99, 71, 0.5)", "borderWidth": 2, "borderDash": [5, 5], "ticker": "VHVE.L", "label": {"display": true, "content": "VHVE.L: +20", "position": "start", "backgroundColor": "rgba(255, 99, 71, 0.8)", "color": "white", "font": {"size": 10, "weight": "bold"}, "padding": 4, "rotation": 0}}, {"type": "line", "xMin": "2023-02-01", "xMax": "2023-02-01", "borderColor": "rgba(255, 99, 71, 0.5)", "borderWidth": 2, "borderDash": [5, 5], "ticker": "VHVE.L", "label": {"display": true, "content": "VHVE.L: +24", "position": "start", "backgroundColor": "rgba(255, 99, 71, 0.8)", "color": "white", "font": {"size": 10, "weight": "bold"}, "padding": 4, "rotation": 0}}, {"type": "line", "xMin": "2023-02-01", "xMax": "2023-02-01", "borderColor": "rgba(255, 99, 71, 0.5)", "borderWidth": 2, "borderDash": [5, 5], "ticker": "EMIM.AS", "label": {"display": true, "content": "EMIM.AS: +56", "position": "start", "backgroundColor": "rgba(255, 99, 71, 0.8)", "color": "white", "font": {"size": 10, "weight": "bold"}, "padding": 4, "rotation": 0}}, {"type": "line", "xMin": "2023-02-01", "xMax": "2023-02-01", "borderColor": "rgba(255, 99, 71, 0.5)", "borderWidth": 2, "borderDash": [5, 5], "ticker": "EMIM.AS", "label": {"display": true, "content": "EMIM.AS: +25", "position": "start", "backgroundColor": "rgba(255, 99, 71, 0.8)", "color": "white", "font": {"size": 10, "weight": "bold"}, "padding": 4, "rotation": 0}}, {"type": "line", "xMin": "2023-02-01", "xMax": "2023-02-01", "borderColor": "rgba(255, 99, 71, 0.5)", "borderWidth": 2, "borderDash": [5, 5], "ticker": "VHVE.L", "label": {"display": true, "content": "VHVE.L: +36", "position": "start", "backgroundColor": "rgba(255, 99, 71, 0.8)", "color": "white", "font": {"size": 10, "weight": "bold"}, "padding": 4, "rotation": 0}}, {"type": "line", "xMin": "2023-03-01", "xMax": "2023-03-01", "borderColor": "rgba(255, 99, 71, 0.5)", "borderWidth": 2, "borderDash": [5, 5], "ticker": "VHVE.L", "label": {"display": true, "content": "VHVE.L: +59", "position": "start", "backgroundColor": "rgba(255, 99, 71, 0.8)", "color": "white", "font": {"size": 10, "weight": "bold"}, "padding": 4, "rotation": 0}}, {"type": "line", "xMin": "2024-11-01", "xMax": "2024-11-01", "borderColor": "rgba(255, 99, 71, 0.5)", "borderWidth": 2, "borderDash": [5, 5], "ticker": "VHVE.L", "label": {"display": true, "content": "VHVE.L: +32", "position": "start", "backgroundColor": "rgba(255, 99, 71, 0.8)", "color": "white", "font": {"size": 10, "weight": "bold"}, "padding": 4, "rotation": 0}}, {"type": "line", "xMin": "2024-12-01", "xMax": "2024-12-01", "borderColor": "rgba(255, 99, 71, 0.5)", "borderWidth": 2, "borderDash": [5, 5], "ticker": "VHVE.L", "label": {"display": true, "content": "VHVE.L: +13", "position": "start", "backgroundColor": "rgba(255, 99, 71, 0.8)", "color": "white", "font": {"size": 10, "weight": "bold"}, "padding": 4, "rotation": 0}}, {"type": "line", "xMin": "2024-12-01", "xMax": "2024-12-01", "borderColor": "rgba(255, 99, 71, 0.5)", "borderWidth": 2, "borderDash": [5, 5], "ticker": "VHVE.L", "label": {"display": true, "content": "VHVE.L: +22", "position": "start", "backgroundColor": "rgba(255, 99, 71, 0.8)", "color": "white", "font": {"size": 10, "weight": "bold"}, "padding": 4, "rotation": 0}}, {"type": "line", "xMin": "2025-01-01", "xMax": "2025-01-01", "borderColor": "rgba(255, 99, 71, 0.5)", "borderWidth": 2, "borderDash": [5, 5], "ticker": "VHVE.L", "label": {"display": true, "content": "VHVE.L: +16", "position": "start", "backgroundColor": "rgba(255, 99, 71, 0.8)", "color": "white", "font": {"size": 10, "weight": "bold"}, "padding": 4, "rotation": 0}}, {"type": "line", "xMin": "2025-05-01", "xMax": "2025-05-01", "borderColor": "rgba(255, 99, 71, 0.5)", "borderWidth": 2, "borderDash": [5, 5], "ticker": "VHVE.L", "label": {"display": true, "content": "VHVE.L: +37", "position": "start", "backgroundColor": "rgba(255, 99, 71, 0.8)", "color": "white", "font": {"size": 10, "weight": "bold"}, "padding": 4, "rotation": 0}}, {"type": "line", "xMin": "2025-10-01", "xMax": "2025-10-01", "borderColor": "rgba(255, 99, 71, 0.5)", "borderWidth": 2, "borderDash": [5, 5], "ticker": "VHVE.L", "label": {"display": true, "content": "VHVE.L: +24", "position": "start", "backgroundColor": "rgba(255, 99, 71, 0.8)", "color": "white", "font": {"size": 10, "weight": "bold"}, "padding": 4, "rotation": 0}}, {"type": "line", "xMin": "2025-10-01", "xMax": "2025-10-01", "borderColor": "rgba(255, 99, 71, 0.5)", "borderWidth": 2, "borderDash": [5, 5], "ticker": "BRK-B", "label": {"display": true, "content": "BRK-B: +8", "position": "start", "backgroundColor": "rgba(255, 99, 71, 0.8)", "color": "white", "font": {"size": 10, "weight": "bold"}, "padding": 4, "rotation": 0}}, {"type": "line", "xMin": "2025-10-01", "xMax": "2025-10-01", "borderColor": "rgba(255, 99, 71, 0.5)", "borderWidth": 2, "borderDash": [5, 5], "ticker": "VHVE.L", "label": {"display": true, "content": "VHVE.L: +3", "position": "start", "backgroundColor": "rgba(255, 99, 71, 0.8)", "color": "white", "font": {"size": 10, "weight": "bold"}, "padding": 4, "rotation": 0}}]
                    }
                },
                scales: {
                    y: {
                        beginAtZero: false,
                        ticks: {
                            callback: function(value) {
                                const currency = currentCurrency;
                                return value.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',') + ' ' + currency;
                            }
                        }
                    },
                    x: {
                        ticks: {
                            maxRotation: 45,
                            minRotation: 45
                        }
                    }
                }
            }
        });

        // Store all annotations
        const allAnnotations = [{"type": "line", "xMin": "2023-02-01", "xMax": "2023-02-01", "borderColor": "rgba(255, 99, 71, 0.5)", "borderWidth": 2, "borderDash": [5, 5], "ticker": "VHVE.L", "label": {"display": true, "content": "VHVE.L: +7", "position": "start", "backgroundColor": "rgba(255, 99, 71, 0.8)", "color": "white", "font": {"size": 10, "weight": "bold"}, "padding": 4, "rotation": 0}}, {"type": "line", "xMin": "2023-02-01", "xMax": "2023-02-01", "borderColor": "rgba(255, 99, 71, 0.5)", "borderWidth": 2, "borderDash": [5, 5], "ticker": "VHVE.L", "label": {"display": true, "content": "VHVE.L: +20", "position": "start", "backgroundColor": "rgba(255, 99, 71, 0.8)", "color": "white", "font": {"size": 10, "weight": "bold"}, "padding": 4, "rotation": 0}}, {"type": "line", "xMin": "2023-02-01", "xMax": "2023-02-01", "borderColor": "rgba(255, 99, 71, 0.5)", "borderWidth": 2, "borderDash": [5, 5], "ticker": "VHVE.L", "label": {"display": true, "content": "VHVE.L: +24", "position": "start", "backgroundColor": "rgba(255, 99, 71, 0.8)", "color": "white", "font": {"size": 10, "weight": "bold"}, "padding": 4, "rotation": 0}}, {"type": "line", "xMin": "2023-02-01", "xMax": "2023-02-01", "borderColor": "rgba(255, 99, 71, 0.5)", "borderWidth": 2, "borderDash": [5, 5], "ticker": "EMIM.AS", "label": {"display": true, "content": "EMIM.AS: +56", "position": "start", "backgroundColor": "rgba(255, 99, 71, 0.8)", "color": "white", "font": {"size": 10, "weight": "bold"}, "padding": 4, "rotation": 0}}, {"type": "line", "xMin": "2023-02-01", "xMax": "2023-02-01", "borderColor": "rgba(255, 99, 71, 0.5)", "borderWidth": 2, "borderDash": [5, 5], "ticker": "EMIM.AS", "label": {"display": true, "content": "EMIM.AS: +25", "position": "start", "backgroundColor": "rgba(255, 99, 71, 0.8)", "color": "white", "font": {"size": 10, "weight": "bold"}, "padding": 4, "rotation": 0}}, {"type": "line", "xMin": "2023-02-01", "xMax": "2023-02-01", "borderColor": "rgba(255, 99, 71, 0.5)", "borderWidth": 2, "borderDash": [5, 5], "ticker": "VHVE.L", "label": {"display": true, "content": "VHVE.L: +36", "position": "start", "backgroundColor": "rgba(255, 99, 71, 0.8)", "color": "white", "font": {"size": 10, "weight": "bold"}, "padding": 4, "rotation": 0}}, {"type": "line", "xMin": "2023-03-01", "xMax": "2023-03-01", "borderColor": "rgba(255, 99, 71, 0.5)", "borderWidth": 2, "borderDash": [5, 5], "ticker": "VHVE.L", "label": {"display": true, "content": "VHVE.L: +59", "position": "start", "backgroundColor": "rgba(255, 99, 71, 0.8)", "color": "white", "font": {"size": 10, "weight": "bold"}, "padding": 4, "rotation": 0}}, {"type": "line", "xMin": "2024-11-01", "xMax": "2024-11-01", "borderColor": "rgba(255, 99, 71, 0.5)", "borderWidth": 2, "borderDash": [5, 5], "ticker": "VHVE.L", "label": {"display": true, "content": "VHVE.L: +32", "position": "start", "backgroundColor": "rgba(255, 99, 71, 0.8)", "color": "white", "font": {"size": 10, "weight": "bold"}, "padding": 4, "rotation": 0}}, {"type": "line", "xMin": "2024-12-01", "xMax": "2024-12-01", "borderColor": "rgba(255, 99, 71, 0.5)", "borderWidth": 2, "borderDash": [5, 5], "ticker": "VHVE.L", "label": {"display": true, "content": "VHVE.L: +13", "position": "start", "backgroundColor": "rgba(255, 99, 71, 0.8)", "color": "white", "font": {"size": 10, "weight": "bold"}, "padding": 4, "rotation": 0}}, {"type": "line", "xMin": "2024-12-01", "xMax": "2024-12-01", "borderColor": "rgba(255, 99, 71, 0.5)", "borderWidth": 2, "borderDash": [5, 5], "ticker": "VHVE.L", "label": {"display": true, "content": "VHVE.L: +22", "position": "start", "backgroundColor": "rgba(255, 99, 71, 0.8)", "color": "white", "font": {"size": 10, "weight": "bold"}, "padding": 4, "rotation": 0}}, {"type": "line", "xMin": "2025-01-01", "xMax": "2025-01-01", "borderColor": "rgba(255, 99, 71, 0.5)", "borderWidth": 2, "borderDash": [5, 5], "ticker": "VHVE.L", "label": {"display": true, "content": "VHVE.L: +16", "position": "start", "backgroundColor": "rgba(255, 99, 71, 0.8)", "color": "white", "font": {"size": 10, "weight": "bold"}, "padding": 4, "rotation": 0}}, {"type": "line", "xMin": "2025-05-01", "xMax": "2025-05-01", "borderColor": "rgba(255, 99, 71, 0.5)", "borderWidth": 2, "borderDash": [5, 5], "ticker": "VHVE.L", "label": {"display": true, "content": "VHVE.L: +37", "position": "start", "backgroundColor": "rgba(255, 99, 71, 0.8)", "color": "white", "font": {"size": 10, "weight": "bold"}, "padding": 4, "rotation": 0}}, {"type": "line", "xMin": "2025-10-01", "xMax": "2025-10-01", "borderColor": "rgba(255, 99, 71, 0.5)", "borderWidth": 2, "borderDash": [5, 5], "ticker": "VHVE.L", "label": {"display": true, "content": "VHVE.L: +24", "position": "start", "backgroundColor": "rgba(255, 99, 71, 0.8)", "color": "white", "font": {"size": 10, "weight": "bold"}, "padding": 4, "rotation": 0}}, {"type": "line", "xMin": "2025-10-01", "xMax": "2025-10-01", "borderColor": "rgba(255, 99, 71, 0.5)", "borderWidth": 2, "borderDash": [5, 5], "ticker": "BRK-B", "label": {"display": true, "content": "BRK-B: +8", "position": "start", "backgroundColor": "rgba(255, 99, 71, 0.8)", "color": "white", "font": {"size": 10, "weight": "bold"}, "padding": 4, "rotation": 0}}, {"type": "line", "xMin": "2025-10-01", "xMax": "2025-10-01", "borderColor": "rgba(255, 99, 71, 0.5)", "borderWidth": 2, "borderDash": [5, 5], "ticker": "VHVE.L", "label": {"display": true, "content": "VHVE.L: +3", "position": "start", "backgroundColor": "rgba(255, 99, 71, 0.8)", "color": "white", "font": {"size": 10, "weight": "bold"}, "padding": 4, "rotation": 0}}];

        // Store ticker statistics (all three currencies)
        const tickerStats = {"VHVE.L": {"current_value_usd": 39033.46, "cost_basis_usd": 115512.32131999999, "profit_usd": -76478.86132, "return_percent_usd": -66.20840136017449, "current_value_eur": 33557.07, "cost_basis_eur": 115512.32131999999, "profit_eur": -81955.25131999998, "return_percent_eur": -70.94935880732761, "current_value_pln": 142269.16, "cost_basis_pln": 115512.32131999999, "profit_pln": 26756.838680000015, "return_percent_pln": 23.163623044052958}, "EMIM.AS": {"current_value_usd": 3654.76, "cost_basis_usd": 10397.139029999998, "profit_usd": -6742.379029999998, "return_percent_usd": -64.8484069564279, "current_value_eur": 3141.99, "cost_basis_eur": 10397.139029999998, "profit_eur": -7255.149029999999, "return_percent_eur": -69.7802444409556, "current_value_pln": 13320.15, "cost_basis_pln": 10397.139029999998, "profit_pln": 2923.010970000001, "return_percent_pln": 28.113608576031528}, "BRK-B": {"current_value_usd": 3904.56, "cost_basis_usd": 14307.82768, "profit_usd": -10403.26768, "return_percent_usd": -72.71032271755736, "current_value_eur": 3356.75, "cost_basis_eur": 14307.82768, "profit_eur": -10951.07768, "return_percent_eur": -76.5390660617741, "current_value_pln": 14231.34, "cost_basis_pln": 14307.82768, "profit_pln": -76.48768000000018, "return_percent_pln": -0.5345862538372435}};
        const totalStats = {
            current_value_usd: 46592.78,
            cost_basis_usd: 140217.28802999997,
            profit_usd: -93624.50802999997,
            return_percent_usd: -66.77101614600383,
            current_value_eur: 40055.81,
            cost_basis_eur: 140217.28802999997,
            profit_eur: -100161.47802999997,
            return_percent_eur: -71.43304469600787,
            current_value_pln: 169820.65,
            cost_basis_pln: 140217.28802999997,
            profit_pln: 29603.361970000027,
            return_percent_pln: 21.112490753398603
        };

        // Function to update stats display
        function updateStats(label, stats) {
            const currency = currentCurrency;
            const suffix = ' ' + currency;

            const currentValue = stats['current_value_' + currency.toLowerCase()];
            const costBasis = stats['cost_basis_' + currency.toLowerCase()];
            const profit = stats['profit_' + currency.toLowerCase()];
            const returnPercent = stats['return_percent_' + currency.toLowerCase()];

            document.getElementById('statsLabel').textContent = label;
            document.getElementById('statCurrentValue').textContent = currentValue.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',') + suffix;
            document.getElementById('statTotalCost').textContent = costBasis.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',') + suffix;

            const profitElement = document.getElementById('statProfit');
            const profitSign = profit >= 0 ? '+' : '';
            profitElement.textContent = profitSign + profit.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',') + suffix;
            profitElement.className = 'stat-value ' + (profit >= 0 ? 'positive' : 'negative');

            const returnElement = document.getElementById('statReturn');
            const returnSign = returnPercent >= 0 ? '+' : '';
            returnElement.textContent = returnSign + returnPercent.toFixed(2) + '%';
            returnElement.className = 'stat-value ' + (returnPercent >= 0 ? 'positive' : 'negative');
        }

        // Function to switch dataset currency
        function switchCurrency(currency) {
            currentCurrency = currency;
            const dataKey = 'data' + currency;
            const profitKey = 'profits' + currency;

            // Update all datasets
            chart.data.datasets.forEach(dataset => {
                if (dataset[dataKey]) {
                    dataset.data = dataset[dataKey];
                }
                if (dataset[profitKey]) {
                    dataset.profits = dataset[profitKey];
                }
            });

            chart.update();

            // Update stats based on current filter
            const selectedTicker = document.getElementById('tickerFilter').value;
            if (selectedTicker === 'all' || selectedTicker === 'total') {
                updateStats(selectedTicker === 'all' ? 'All Tickers' : 'Total Portfolio Only', totalStats);
            } else {
                updateStats(selectedTicker, tickerStats[selectedTicker]);
            }
        }

        // Dropdown filter functionality
        document.getElementById('tickerFilter').addEventListener('change', function(e) {
            const selectedTicker = e.target.value;

            if (selectedTicker === 'all') {
                // Show all datasets (ticker values, ticker profits, total value, and total profit)
                chart.data.datasets = [...tickerValueDatasets, ...tickerProfitDatasets, totalValueDataset, totalProfitDataset];
                // Show all annotations
                chart.options.plugins.annotation.annotations = allAnnotations;
                // Update stats to show total portfolio
                updateStats('All Tickers', totalStats);
            } else if (selectedTicker === 'total') {
                // Show only total portfolio value and profit
                chart.data.datasets = [totalValueDataset, totalProfitDataset];
                // Show all annotations for total view
                chart.options.plugins.annotation.annotations = allAnnotations;
                // Update stats to show total portfolio
                updateStats('Total Portfolio Only', totalStats);
            } else {
                // Show only the selected ticker's value and profit
                const tickerValueDs = tickerValueDatasets.filter(ds => ds.tickerName === selectedTicker);
                const tickerProfitDs = tickerProfitDatasets.filter(ds => ds.tickerName === selectedTicker);
                chart.data.datasets = [...tickerValueDs, ...tickerProfitDs];
                // Show only annotations for selected ticker
                chart.options.plugins.annotation.annotations = allAnnotations.filter(ann => ann.ticker === selectedTicker);
                // Update stats to show selected ticker
                updateStats(selectedTicker, tickerStats[selectedTicker]);
            }

            chart.update();
        });

        // Currency filter functionality
        document.getElementById('currencyFilter').addEventListener('change', function(e) {
            const selectedCurrency = e.target.value;
            switchCurrency(selectedCurrency);
        });

    </script>
</body>
</html>
